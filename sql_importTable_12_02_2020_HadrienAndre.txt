DROP TABLE IF EXISTS article,author,country,isprs_brut,organisation,theme;
DROP EXTENSION IF EXISTS postgis;
CREATE EXTENSION postgis;

CREATE TABLE "isprs_brut"(
  "paperid" character varying(150),
  "contributor_type" character varying(150),
  "contributor_format" character varying(150),
  "authors" character varying(150),
  "organisations" character varying(150),
  "title" character varying(200),
  "keywords" character varying(150),
  "topics" character varying(150),
  "submitting_author" character varying(150),
  "sa_organisation" character varying(300),
  "sa_country" character varying(300),
  "sa_region" character varying(150),
  "sa_email" character varying(150),
  "all_emails" character varying(150),
  "studentpaper" boolean,
)
WITH (
  OIDS=FALSE
);
ALTER TABLE "isprs_brut"
  OWNER TO postgres;

GRANT SELECT ON isprs_brut TO PUBLIC;

COPY public."isprs_brut" FROM 'C:\ms4w\Apache\htdocs\AS_papers\Export_IGAST_12022020.csv' WITH (FORMAT 'csv', DELIMITER ';',HEADER, ENCODING 'latin1');

ALTER TABLE "isprs_brut" ADD COLUMN id SERIAL PRIMARY KEY;

CREATE TABLE submitting_author AS SELECT DISTINCT ON (sa_email) sa_email, id, sa_country, sa_region, sa_email, sa_organisation FROM "isprs_brut";
ALTER TABLE submittingauthor ADD PRIMARY KEY (author_email);

CREATE TABLE country AS SELECT DISTINCT ON (sa_email) sa_email, sa_country FROM author;
ALTER TABLE country ADD PRIMARY KEY (sa_email);

CREATE TABLE organisation AS SELECT DISTINCT ON (sa_email) sa_email, sa_organisation FROM "isprs_brut";
ALTER TABLE organisation ADD PRIMARY KEY (sa_email);

CREATE TABLE article AS SELECT DISTINCT ON (paperid) paperid, contributor_type, contributor_format sa_email, authors, organisations, title, topics, keywords, studentpaper FROM "isprs_brut";
ALTER TABLE article ADD PRIMARY KEY (paperid);
ALTER TABLE article ADD COLUMN geom geometry(point, 4326);

CREATE TABLE theme AS SELECT DISTINCT ON (paperid) paperid, contributor_type FROM "isprs_brut";
ALTER TABLE theme ADD PRIMARY KEY (paperid);

